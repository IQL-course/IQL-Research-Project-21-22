setwd("/Users/sonia/Library/Mobile Documents/com~apple~CloudDocs/FIB/IQL/IQLproject/IQL-Research-Project-21-22")
source('code/analysis/R_functions.R', encoding="utf-8")
filter <- T
# GLOBALS  --------------------------------------------------------
langs_df_pud <- read.csv(paste0(which_folder('data',filter),"/descriptive_tables/pud.csv"))
langs_df_cv <- read.csv(paste0(which_folder('data',filter),"/descriptive_tables/common_voice.csv")) %>%
shorten_names()
plot_corr_evolution <- function(df) {
df <- df %>%
mutate(correlation=ifelse(correlation=='kendall', 'Kendall correlation','Pearson correlation')) %>%
mutate(parameter = factor(parameter, levels = c('Lmin','Lr','Lmin/Lr')))
ggplot(df,aes(randomizations,coefficient,color=score)) +
geom_line(size=1) + geom_point(aes(shape=significance),size=4) +
facet_grid(rows = vars(correlation), cols=vars(parameter), labeller = labeller(parameter = params_labs)) +
geom_hline(yintercept = 0,linetype='dashed') +
scale_shape_manual(values=c('significant'=1,'non-significant'=4)) +
scale_color_discrete(labels = c('\u03B7','\u03A8','\u03A9')) +
scale_x_log10(labels = label_log()) + standart_theme
}
length_def <- 'characters'
dfs <- lapply(c(1000,10000,1e+05,1e+06), function(iters) {
dfs <- lapply(c('kendall','pearson'), function(plot_corr) {
read_file('null','cv',filter=filter,length=length_def,iters=iters) %>%
long_corr_df(plot_corr,HB_correct = T)
})
do.call(rbind,dfs) %>% mutate(randomizations=iters)
})
do.call(rbind,dfs) %>% plot_corr_evolution()
do.call(rbind,dfs) %>% plot_corr_evolution()
params_labs <- c('Lmin'=expression(L[min]),'Lr'=expression(L[r]),'Lmin/Lr'=expression(L[min]/L[r]))
params_labs <- c('Lmin'=expression(L[min]),'Lr'=expression(L[r]),'Lmin/Lr'=expression(L[min]/L[r]))
plot_corr_evolution <- function(df) {
df <- df %>%
mutate(correlation=ifelse(correlation=='kendall', 'Kendall correlation','Pearson correlation')) %>%
mutate(parameter = factor(parameter, levels = c('Lmin','Lr','Lmin/Lr')))
ggplot(df,aes(randomizations,coefficient,color=score)) +
geom_line(size=1) + geom_point(aes(shape=significance),size=4) +
facet_grid(rows = vars(correlation), cols=vars(parameter), labeller = labeller(parameter = params_labs)) +
geom_hline(yintercept = 0,linetype='dashed') +
scale_shape_manual(values=c('significant'=1,'non-significant'=4)) +
scale_color_discrete(labels = c('\u03B7','\u03A8','\u03A9')) +
scale_x_log10(labels = label_log()) + standart_theme
}
do.call(rbind,dfs) %>% plot_corr_evolution()
plot_corr_evolution <- function(df) {
df <- df %>%
mutate(correlation=ifelse(correlation=='kendall', 'Kendall correlation','Pearson correlation')) %>%
mutate(parameter = factor(parameter, levels = c('Lmin','Lr','Lmin/Lr')))
ggplot(df,aes(randomizations,coefficient,color=score)) +
geom_line(size=1) + geom_point(aes(shape=significance),size=4) +
facet_grid(rows = vars(correlation), cols=vars(parameter), labeller = label_parsed(parameter = params_labs)) +
geom_hline(yintercept = 0,linetype='dashed') +
scale_shape_manual(values=c('significant'=1,'non-significant'=4)) +
scale_color_discrete(labels = c('\u03B7','\u03A8','\u03A9')) +
scale_x_log10(labels = label_log()) + standart_theme
}
do.call(rbind,dfs) %>% plot_corr_evolution()
ggplot(df,aes(randomizations,coefficient,color=score)) +
geom_line(size=1) + geom_point(aes(shape=significance),size=4) +
facet_grid(rows = vars(correlation), cols=vars(parameter), labeller = label_parsed(params_labs)) +
geom_hline(yintercept = 0,linetype='dashed') +
scale_shape_manual(values=c('significant'=1,'non-significant'=4)) +
scale_color_discrete(labels = c('\u03B7','\u03A8','\u03A9')) +
scale_x_log10(labels = label_log()) + standart_theme
plot_corr_evolution <- function(df) {
df <- df %>%
mutate(correlation=ifelse(correlation=='kendall', 'Kendall correlation','Pearson correlation')) %>%
mutate(parameter = factor(parameter, levels = c('Lmin','Lr','Lmin/Lr')))
ggplot(df,aes(randomizations,coefficient,color=score)) +
geom_line(size=1) + geom_point(aes(shape=significance),size=4) +
facet_grid(rows = vars(correlation), cols=vars(parameter), labeller = label_parsed(params_labs)) +
geom_hline(yintercept = 0,linetype='dashed') +
scale_shape_manual(values=c('significant'=1,'non-significant'=4)) +
scale_color_discrete(labels = c('\u03B7','\u03A8','\u03A9')) +
scale_x_log10(labels = label_log()) + standart_theme
}
do.call(rbind,dfs) %>% plot_corr_evolution()
plot_corr_evolution <- function(df) {
df <- df %>%
mutate(correlation=ifelse(correlation=='kendall', 'Kendall correlation','Pearson correlation')) %>%
mutate(parameter = factor(parameter, levels = c('Lmin','Lr','Lmin/Lr')))
ggplot(df,aes(randomizations,coefficient,color=score)) +
geom_line(size=1) + geom_point(aes(shape=significance),size=4) +
facet_grid(rows = vars(correlation), cols=vars(parameter), labeller = label_parsed) +
geom_hline(yintercept = 0,linetype='dashed') +
scale_shape_manual(values=c('significant'=1,'non-significant'=4)) +
scale_color_discrete(labels = c('\u03B7','\u03A8','\u03A9')) +
scale_x_log10(labels = label_log()) + standart_theme
}
do.call(rbind,dfs) %>% plot_corr_evolution()
plot_corr_evolution <- function(df) {
df <- df %>%
mutate(correlation=ifelse(correlation=='kendall', 'Kendall correlation','Pearson correlation')) %>%
mutate(parameter = factor(parameter, levels = c('Lmin','Lr','Lmin/Lr')))
ggplot(df,aes(randomizations,coefficient,color=score)) +
geom_line(size=1) + geom_point(aes(shape=significance),size=4) +
facet_grid(rows = vars(correlation), cols=vars(parameter), labeller = labeller(parameter = label_parsed)) +
geom_hline(yintercept = 0,linetype='dashed') +
scale_shape_manual(values=c('significant'=1,'non-significant'=4)) +
scale_color_discrete(labels = c('\u03B7','\u03A8','\u03A9')) +
scale_x_log10(labels = label_log()) + standart_theme
}
do.call(rbind,dfs) %>% plot_corr_evolution()
plot_corr_evolution <- function(df) {
df <- df %>%
mutate(correlation=ifelse(correlation=='kendall', 'Kendall correlation','Pearson correlation')) %>%
mutate(parameter = ifelse(parameter=='Lmin','L[min]',ifelse(parameter=='Lr','L[r]','L[min]/L[r]'))) %>%
mutate(parameter = factor(parameter, levels = c('L[min]','L[r]','L[min]/L[r]')))
ggplot(df,aes(randomizations,coefficient,color=score)) +
geom_line(size=1) + geom_point(aes(shape=significance),size=4) +
facet_grid(rows=vars(correlation),cols=vars(parameter),labeller = labeller(parameter = label_parsed)) +
geom_hline(yintercept = 0,linetype='dashed') +
scale_shape_manual(values=c('significant'=1,'non-significant'=4)) +
scale_color_discrete(labels = c('\u03B7','\u03A8','\u03A9')) +
scale_x_log10(labels = label_log()) + standart_theme
}
do.call(rbind,dfs) %>% plot_corr_evolution()
## + cv
res <- lapply(length_defs, function(length_def) {
dfs <- lapply(c(1000,10000,1e+05,1e+06), function(iters) {
dfs <- lapply(c('kendall','pearson'), function(plot_corr) {
read_file('null','cv',filter=filter,length=length_def,iters=iters) %>%
long_corr_df(plot_corr,HB_correct = T)
})
do.call(rbind,dfs) %>% mutate(randomizations=iters)
})
p <- do.call(rbind,dfs) %>% plot_corr_evolution()
ggsave(paste0(which_folder('figures',filter),'/corr_evolution_cv_',length_def,'.pdf'),
device = cairo_pdf, width = 9, height = 5)
})
## + pud
dfs <- lapply(c(1000,10000,1e+05,1e+06), function(iters) {
dfs <- lapply(c('kendall','pearson'), function(plot_corr) {
read_file('null','pud',filter=filter,length='characters',iters=iters) %>%
long_corr_df(plot_corr,HB_correct = T)
})
do.call(rbind,dfs) %>% mutate(randomizations=iters)
})
df <- do.call(rbind,dfs)
plot_corr_evolution(df)
ggsave(paste0(which_folder('figures',filter),'/corr_evolution_pud_characters.pdf'),
device = cairo_pdf, width = 9, height = 5)
dfs <- lapply(c(1000,10000,1e+05,1e+06), function(iters) {
dfs <- lapply(c('kendall','pearson'), function(plot_corr) {
read_file('null','cv',filter=filter,length=length_def,iters=iters) %>%
long_corr_df(plot_corr,HB_correct = T)
})
do.call(rbind,dfs) %>% mutate(randomizations=iters)
})
length_def <- 'medianDuration'
dfs <- lapply(c(1000,10000,1e+05,1e+06), function(iters) {
dfs <- lapply(c('kendall','pearson'), function(plot_corr) {
read_file('null','cv',filter=filter,length=length_def,iters=iters) %>%
long_corr_df(plot_corr,HB_correct = T)
})
do.call(rbind,dfs) %>% mutate(randomizations=iters)
})
p <- do.call(rbind,dfs) %>% plot_corr_evolution()
## + cv
res <- lapply(length_defs, function(length_def) {
dfs <- lapply(c(1000,10000,1e+05,1e+06), function(iters) {
dfs <- lapply(c('kendall','pearson'), function(plot_corr) {
read_file('null','cv',filter=filter,length=length_def,iters=iters) %>%
long_corr_df(plot_corr,HB_correct = T)
})
do.call(rbind,dfs) %>% mutate(randomizations=iters)
})
p <- do.call(rbind,dfs) %>% plot_corr_evolution()
ggsave(paste0(which_folder('figures',filter),'/corr_evolution_cv_',length_def,'.pdf'),
device = cairo_pdf, width = 9, height = 5)
})
plot_corr
dfs <- lapply(c(1000,10000,1e+05,1e+06), function(iters) {
dfs <- lapply(c('kendall','pearson'), function(plot_corr) {
read_file('null','cv',filter=filter,length=length_def,iters=iters) %>%
long_corr_df(plot_corr,HB_correct = T)
})
do.call(rbind,dfs) %>% mutate(randomizations=iters)
})
length_def
dfs <- lapply(c(1000,10000,1e+05,1e+06), function(iters) {
dfs <- lapply(c('kendall','pearson'), function(plot_corr) {
read_file('null','cv',filter=filter,length=length_def,iters=iters) %>%
long_corr_df(plot_corr,HB_correct = T)
})
do.call(rbind,dfs) %>% mutate(randomizations=iters)
})
p <- do.call(rbind,dfs) %>% plot_corr_evolution()
ggsave(paste0(which_folder('figures',filter),'/corr_evolution_cv_',length_def,'.pdf'),
device = cairo_pdf, width = 9, height = 5)
length_def <- 'characters'
dfs <- lapply(c(1000,10000,1e+05,1e+06), function(iters) {
dfs <- lapply(c('kendall','pearson'), function(plot_corr) {
read_file('null','cv',filter=filter,length=length_def,iters=iters) %>%
long_corr_df(plot_corr,HB_correct = T)
})
do.call(rbind,dfs) %>% mutate(randomizations=iters)
})
p <- do.call(rbind,dfs) %>% plot_corr_evolution()
ggsave(paste0(which_folder('figures',filter),'/corr_evolution_cv_',length_def,'.pdf'),
device = cairo_pdf, width = 9, height = 5)
length_defs
iters <- 1e+06
rows_cv <- lapply(length_defs, function(length_def) {
df <- read_file('null','cv',filter,length_def,iters=iters)%>%
mutate(`Lmin/Lrand` = Lmin/Lrand) %>% select(language,Lmin,psi,omega) %>%
rename(`E[psi]`=psi, `E[omega]`=omega) %>% mutate(length_def = length_def) %>%
merge(langs_df_cv[,c('language','X.tokens')], by = 'language')
})
df <- do.call(rbind,rows_cv)
reshape2::melt(df, id.vars=c('language','Lmin','length_def','X.tokens')) %>%
ggplot(aes(x=`Lmin`,y=value,label=ifelse(log10(X.tokens)<=4,language,''),fill=log10(X.tokens))) +
geom_text_repel(size=3,color='black',box.padding=0.5)+
geom_point(colour="black",pch=21,size=3) + geom_hline(yintercept = 0,color='purple',linetype='dashed') +
facet_grid(cols=vars(length_def),rows=vars(variable),scales = 'free',
labeller = labeller(variable=exp_scores_labs, length_def=length_labs)) +
scale_fill_gradient2(low = "red", mid = "yellow", high = "green", midpoint = 5) +
labs(fill=expression(paste(log[10],'T')), x=bquote(L[min]), y = 'expected score') +
scale_y_continuous(label=scientific_10) +
theme(text = element_text(size = 16),
legend.text = element_text(size = 13),
legend.title = element_text(size = 13))
length_defs
iters <- 1e+06
rows_cv <- lapply(length_defs, function(length_def) {
df <- read_file('null','cv',filter,length_def,iters=iters)%>%
mutate(`Lmin/Lrand` = Lmin/Lrand) %>% select(language,Lmin,psi,omega) %>%
rename(`E[psi]`=psi, `E[omega]`=omega) %>% mutate(length_def = length_def) %>%
merge(langs_df_cv[,c('language','X.tokens')], by = 'language')
})
rows_cv
rows_cv <- lapply(length_defs, function(length) {
df <- read_file('null','cv',filter,length,iters=iters)%>%
mutate(`Lmin/Lrand` = Lmin/Lrand) %>% select(language,Lmin,psi,omega) %>%
rename(`E[psi]`=psi, `E[omega]`=omega) %>% mutate(length_def = length) %>%
merge(langs_df_cv[,c('language','X.tokens')], by = 'language')
})
rows_cv
length <- 'medianDuration'
iters
df <- read_file('null','cv',filter,length,iters=iters)%>%
mutate(`Lmin/Lrand` = Lmin/Lrand) %>% select(language,Lmin,psi,omega) %>%
rename(`E[psi]`=psi, `E[omega]`=omega) %>% mutate(length_def = length) %>%
merge(langs_df_cv[,c('language','X.tokens')], by = 'language')
df
read_file('null','cv',filter,length,iters=iters)
what <- 'null'
file <- if (what %in% c('corr','opt')) 'scores_' else if (what=='null') 'null_hypothesis_'
length_suffix <- ifelse(what=='null',paste0('_',length),'')
iters_suffix  <- ifelse(what=='null',paste0('_',iters),'')
df <- read.csv(paste0(which_folder('results',filter),'/',file,collection,length_suffix,iters_suffix,'.csv'))[-1] %>%
filter(length_def == length)
df
read.csv(paste0(which_folder('results',filter),'/',file,collection,length_suffix,iters_suffix,'.csv'))[-1]
collection <- 'cv'
read.csv(paste0(which_folder('results',filter),'/',file,collection,length_suffix,iters_suffix,'.csv'))[-1]
read.csv(paste0(which_folder('results',filter),'/',file,collection,length_suffix,iters_suffix,'.csv'))[-1]
length <- 'characters'
length_suffix <- ifelse(what=='null',paste0('_',length),'')
iters_suffix  <- ifelse(what=='null',paste0('_',iters),'')
read.csv(paste0(which_folder('results',filter),'/',file,collection,length_suffix,iters_suffix,'.csv'))[-1]
read.csv(paste0(which_folder('results',filter),'/',file,collection,length_suffix,iters_suffix,'.csv'))
read_file <- function(what, collection, filter=T, length='characters', corr_type='kendall', iters=1e+06) {
file <- if (what %in% c('corr','opt')) 'scores_' else if (what=='null') 'null_hypothesis_'
length_suffix <- ifelse(what=='null',paste0('_',length),'')
iters_suffix  <- ifelse(what=='null',paste0('_',iters),'')
df <- read.csv(paste0(which_folder('results',filter),'/',file,collection,length_suffix,iters_suffix,'.csv'))[-1]
# for correlation files
if (what=='corr' & corr_type == 'kendall') {
df <- select(df, language, tau, tau_pval, length_def) %>% rename(corr = tau, pvalue = tau_pval)
} else if (what=='corr' & corr_type == 'pearson') {
df <- select(df, language, r,   r_pval,   length_def) %>% rename(corr = r,   pvalue = r_pval)  }
return(df)
}
iters <- 1e+06
rows_cv <- lapply(length_defs, function(length) {
df <- read_file('null','cv',filter,length,iters=iters) %>%
mutate(`Lmin/Lrand` = Lmin/Lrand) %>% select(language,Lmin,psi,omega) %>%
rename(`E[psi]`=psi, `E[omega]`=omega) %>% mutate(length_def = length) %>%
merge(langs_df_cv[,c('language','X.tokens')], by = 'language')
})
rows_cv
df <- do.call(rbind,rows_cv)
reshape2::melt(df, id.vars=c('language','Lmin','length_def','X.tokens')) %>%
ggplot(aes(x=`Lmin`,y=value,label=ifelse(log10(X.tokens)<=4,language,''),fill=log10(X.tokens))) +
geom_text_repel(size=3,color='black',box.padding=0.5)+
geom_point(colour="black",pch=21,size=3) + geom_hline(yintercept = 0,color='purple',linetype='dashed') +
facet_grid(cols=vars(length_def), rows=vars(variable),scales = 'free',
labeller = labeller(variable=exp_scores_labs, length_def=length_labs)) +
scale_fill_gradient2(low = "red", mid = "yellow", high = "green", midpoint = 5) +
labs(fill=expression(paste(log[10],'T')), x=bquote(L[min]), y = 'expected score') +
scale_y_continuous(label=scientific_10) +
theme(text = element_text(size = 16),
legend.text = element_text(size = 13),
legend.title = element_text(size = 13))
reshape2::melt(df, id.vars=c('language','Lmin','length_def','X.tokens')) %>%
ggplot(aes(x=`Lmin`,y=value,label=ifelse(log10(X.tokens)<=4,language,''),fill=log10(X.tokens))) +
geom_text_repel(size=3,color='black',box.padding=0.5)+
geom_point(colour="black",pch=21,size=3) + geom_hline(yintercept = 0,color='purple',linetype='dashed') +
facet_grid(cols=vars(length_def), rows=vars(variable),scales = 'free',
labeller = labeller(variable=exp_scores_labs, length_def=length_labs)) +
scale_fill_gradient2(low = "red", mid = "yellow", high = "green", midpoint = 5) +
labs(fill=expression(paste(log[10],'T')), x=bquote(L[min]), y = 'expected score') +
scale_y_continuous(label=scientific_10) +
theme(text = element_text(size = 16),
legend.text = element_text(size = 13),
legend.title = element_text(size = 13))
ggsave(paste0(which_folder('figures',filter),'/correlation_scores_Lmin_',iters,'.pdf'),
device = cairo_pdf)
